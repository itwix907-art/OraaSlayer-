<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>👤 ملفي الشخصي - OraaSlayer</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
:root {
  --primary-color: #8B7BFF;
  --secondary-color: #FF7BA9;
  --accent-color: #5FD8FF;
  --bg-dark: #0F0F25;
  --bg-card: rgba(26, 26, 60, 0.7);
  --text-light: #FFFFFF;
  --glass-bg: rgba(255, 255, 255, 0.1);
  --glass-border: rgba(255, 255, 255, 0.2);
  --success-color: #3DD8A9;
  --warning-color: #FFC14D;
  --error-color: #FF6B82;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background: var(--bg-dark);
  color: var(--text-light);
  font-family: 'Cairo', sans-serif;
  min-height: 100vh;
  background-image: 
    radial-gradient(circle at 20% 80%, rgba(139, 123, 255, 0.15) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(255, 123, 169, 0.15) 0%, transparent 50%);
  padding-bottom: 90px;
}

/* شاشة التحميل */
.loading-screen {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--bg-dark);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  transition: opacity 0.5s ease;
}

.loading-spinner {
  width: 50px;
  height: 50px;
  border: 3px solid var(--glass-bg);
  border-top: 3px solid var(--primary-color);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 20px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* شاشة تسجيل الدخول */
.login-required {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: var(--bg-dark);
  z-index: 9998;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  padding: 20px;
}

.login-required.show {
  display: flex;
}

.login-required .icon {
  font-size: 4rem;
  color: var(--primary-color);
  margin-bottom: 20px;
}

.login-required h2 {
  font-size: 1.8rem;
  margin-bottom: 15px;
  color: var(--text-light);
}

.login-required p {
  color: rgba(255, 255, 255, 0.7);
  margin-bottom: 30px;
  font-size: 1.1rem;
  max-width: 400px;
  line-height: 1.6;
}

/* الهيدر */
.main-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: rgba(30, 30, 60, 0.8);
  backdrop-filter: blur(20px);
  padding: 15px 20px;
  border-bottom: 1px solid var(--glass-border);
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.logo {
  font-size: 1.4rem;
  font-weight: 800;
  background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  display: flex;
  align-items: center;
  gap: 10px;
}

.header-actions {
  display: flex;
  gap: 15px;
}

.header-btn {
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  color: var(--text-light);
  padding: 10px 16px;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-family: 'Cairo', sans-serif;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 8px;
}

.header-btn:hover {
  background: rgba(139, 123, 255, 0.2);
  transform: translateY(-2px);
}

/* غلاف الصفحة */
.cover {
  height: 200px;
  background: linear-gradient(135deg, rgba(139, 123, 255, 0.3), rgba(255, 123, 169, 0.3)), 
              url('https://i.ibb.co/JrFz4b2/anime-banner.jpg') center/cover;
  position: relative;
  border-bottom: 1px solid var(--glass-border);
}

.cover::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, transparent 60%, var(--bg-dark) 100%);
}

/* الصندوق الرئيسي */
.profile-box {
  background: var(--bg-card);
  backdrop-filter: blur(20px);
  border-radius: 20px;
  max-width: 100%;
  margin: -80px 15px 30px;
  padding: 25px 20px;
  text-align: center;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
  border: 1px solid var(--glass-border);
  position: relative;
  z-index: 10;
}

/* الصورة الشخصية */
.profile-img {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  border: 4px solid var(--primary-color);
  object-fit: cover;
  margin-top: -80px;
  background: var(--bg-card);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
  position: relative;
  z-index: 20;
}

/* الاسم والتوثيق */
.username {
  margin-top: 20px;
  font-size: 1.6rem;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  font-weight: 700;
  flex-wrap: wrap;
}

.verified {
  color: var(--secondary-color);
  animation: pulse 2s infinite alternate;
  font-size: 1.2rem;
  filter: drop-shadow(0 0 8px var(--secondary-color));
  display: none;
}

@keyframes pulse {
  0% { transform: scale(1); opacity: 0.8; }
  100% { transform: scale(1.2); opacity: 1; }
}

.about {
  color: rgba(255, 255, 255, 0.8);
  font-size: 1rem;
  margin-top: 10px;
  padding: 0 15px;
  line-height: 1.5;
}

/* الإحصائيات */
.stats {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
  margin-top: 25px;
}

.stat {
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  padding: 20px 15px;
  border-radius: 16px;
  border: 1px solid var(--glass-border);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.stat::before {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  width: 4px;
  height: 100%;
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
}

.stat strong {
  display: block;
  font-size: 1.5rem;
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight: 800;
}

.stat span {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.7);
  margin-top: 5px;
  display: block;
}

/* الأزرار */
.btns {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  margin-top: 25px;
}

.btn {
  background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
  border: none;
  color: white;
  padding: 14px 16px;
  border-radius: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  font-family: 'Cairo', sans-serif;
  font-size: 0.9rem;
  position: relative;
  overflow: hidden;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(139, 123, 255, 0.4);
}

.btn i {
  font-size: 1rem;
}

/* أقسام المحتوى */
.section {
  margin: 30px 15px;
}

.section-title {
  font-size: 1.4rem;
  margin-bottom: 20px;
  color: var(--primary-color);
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 700;
}

.section-title i {
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

/* قائمة الأنمي المفضلة */
.anime-list {
  display: flex;
  overflow-x: auto;
  gap: 15px;
  padding: 10px 5px;
  scrollbar-width: thin;
  scrollbar-color: var(--primary-color) transparent;
}

.anime-list::-webkit-scrollbar {
  height: 6px;
}

.anime-list::-webkit-scrollbar-track {
  background: transparent;
  border-radius: 10px;
}

.anime-list::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  border-radius: 10px;
}

.anime-card {
  min-width: 120px;
  text-align: center;
  transition: all 0.4s ease;
  background: var(--bg-card);
  border-radius: 14px;
  overflow: hidden;
  border: 1px solid var(--glass-border);
  position: relative;
  flex-shrink: 0;
}

.anime-card::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  transform: scaleX(0);
  transition: transform 0.3s ease;
}

.anime-card:hover::before {
  transform: scaleX(1);
}

.anime-card img {
  width: 120px;
  height: 170px;
  object-fit: cover;
  background: var(--bg-dark);
  transition: transform 0.4s ease;
}

.anime-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(139, 123, 255, 0.3);
}

.anime-card p {
  padding: 10px 6px;
  font-size: 0.85rem;
  font-weight: 600;
  background: rgba(0, 0, 0, 0.5);
  margin: 0;
}

/* الأوسمة */
.badges {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 15px;
}

.badge {
  background: var(--glass-bg);
  backdrop-filter: blur(10px);
  border-radius: 14px;
  text-align: center;
  padding: 20px 12px;
  transition: all 0.4s ease;
  border: 1px solid var(--glass-border);
  position: relative;
  overflow: hidden;
}

.badge:hover {
  background: rgba(139, 123, 255, 0.15);
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
}

.badge i {
  font-size: 1.8rem;
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  margin-bottom: 10px;
  display: block;
}

.badge p {
  font-weight: 600;
  color: var(--text-light);
  font-size: 0.9rem;
}

/* الفوتر */
footer {
  text-align: center;
  color: rgba(255, 255, 255, 0.6);
  margin-top: 40px;
  font-size: 0.85rem;
  padding: 0 15px;
}

/* زر الرئيسية */
.btn-home {
  position: fixed;
  bottom: 20px;
  left: 20px;
  background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
  border: none;
  border-radius: 50px;
  padding: 14px 22px;
  color: white;
  font-weight: 600;
  cursor: pointer;
  box-shadow: 0 8px 25px rgba(139, 123, 255, 0.5);
  transition: all 0.3s ease;
  z-index: 100;
  display: flex;
  align-items: center;
  gap: 8px;
  font-family: 'Cairo', sans-serif;
  font-size: 0.9rem;
}

.btn-home:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 12px 30px rgba(139, 123, 255, 0.6);
}

/* الإشعارات */
.notification {
  position: fixed;
  top: 80px;
  right: 15px;
  left: 15px;
  background: var(--bg-card);
  backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  color: white;
  padding: 15px 20px;
  border-radius: 14px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
  z-index: 1000;
  transform: translateY(-100%);
  opacity: 0;
  transition: all 0.4s ease;
  display: flex;
  align-items: center;
  gap: 12px;
}

.notification.show {
  transform: translateY(0);
  opacity: 1;
}

.notification i {
  font-size: 1.2rem;
}

.notification.success i {
  color: var(--success-color);
}

.notification.error i {
  color: var(--error-color);
}

.notification.warning i {
  color: var(--warning-color);
}

/* النافذة المنبثقة */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(10px);
  z-index: 2000;
  display: none;
  align-items: center;
  justify-content: center;
  opacity: 0;
  transition: opacity 0.3s ease;
  padding: 15px;
}

.modal-overlay.show {
  display: flex;
  opacity: 1;
}

.modal-box {
  background: var(--bg-card);
  backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  padding: 25px;
  border-radius: 18px;
  width: 100%;
  max-width: 400px;
  text-align: right;
  box-shadow: 0 25px 60px rgba(0, 0, 0, 0.5);
  transform: scale(0.9);
  transition: transform 0.3s ease;
}

.modal-overlay.show .modal-box {
  transform: scale(1);
}

.modal-title {
  font-size: 1.3rem;
  color: var(--primary-color);
  margin-bottom: 20px;
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 700;
}

.modal-input {
  width: 100%;
  padding: 14px 18px;
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: 12px;
  color: var(--text-light);
  font-family: 'Cairo', sans-serif;
  font-size: 1rem;
  margin-bottom: 20px;
  transition: all 0.3s ease;
}

.modal-input:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(139, 123, 255, 0.2);
}

.modal-btns {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
}

.modal-btn {
  border: none;
  padding: 12px 20px;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
  font-family: 'Cairo', sans-serif;
  font-size: 0.9rem;
  min-width: 80px;
}

.modal-btn.confirm {
  background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
  color: white;
}

.modal-btn.confirm:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(139, 123, 255, 0.4);
}

.modal-btn.cancel {
  background: var(--glass-bg);
  color: rgba(255, 255, 255, 0.8);
  border: 1px solid var(--glass-border);
}

.modal-btn.cancel:hover {
  background: rgba(255, 255, 255, 0.1);
  transform: translateY(-2px);
}

/* تحسينات للشاشات المتوسطة */
@media (min-width: 768px) {
  .profile-box {
    margin: -80px auto 30px;
    max-width: 700px;
    padding: 30px;
  }
  
  .profile-img {
    width: 140px;
    height: 140px;
  }
  
  .username {
    font-size: 1.8rem;
  }
  
  .stats {
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
  }
  
  .btns {
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
  }
  
  .section {
    margin: 40px auto;
    max-width: 700px;
  }
  
  .badges {
    grid-template-columns: repeat(3, 1fr);
  }
  
  .notification {
    right: 30px;
    left: auto;
    max-width: 350px;
  }
}

@media (min-width: 1024px) {
  .profile-box {
    max-width: 800px;
  }
  
  .section {
    max-width: 800px;
  }
  
  .badges {
    grid-template-columns: repeat(3, 1fr);
  }
  
  .btns {
    grid-template-columns: repeat(5, 1fr);
  }
}

/* تحسينات خاصة للهواتف الأفقية */
@media (max-height: 600px) and (orientation: landscape) {
  .cover {
    height: 150px;
  }
  
  .profile-box {
    margin: -60px 15px 20px;
    padding: 20px 15px;
  }
  
  .profile-img {
    width: 80px;
    height: 80px;
    margin-top: -60px;
  }
  
  .username {
    font-size: 1.4rem;
    margin-top: 15px;
  }
  
  .stats {
    margin-top: 15px;
  }
}

/* تحسينات للشاشات الكبيرة جداً */
@media (min-width: 1400px) {
  .profile-box {
    max-width: 900px;
  }
  
  .section {
    max-width: 900px;
  }
}
</style>
</head>

<body>
<!-- شاشة التحميل -->
<div class="loading-screen" id="loadingScreen">
  <div class="loading-spinner"></div>
  <p>جاري تحميل البيانات...</p>
</div>

<!-- شاشة تسجيل الدخول -->
<div class="login-required" id="loginRequired">
  <div class="icon">🔒</div>
  <h2>تسجيل الدخول مطلوب</h2>
  <p>يجب عليك تسجيل الدخول للوصول إلى صفحة البروفايل الخاصة بك وتعديل بياناتك الشخصية</p>
  <button class="btn" onclick="location.href='login.html'">
    <i class="fa-solid fa-right-to-bracket"></i>تسجيل الدخول
  </button>
</div>

<!-- المحتوى الرئيسي -->
<div id="mainContent" style="display: none;">
  <!-- الهيدر -->
  <header class="main-header">
    <div class="logo">🌀 OraaSlayer</div>
    <div class="header-actions">
      <button class="header-btn" onclick="location.href='index.html'">
        <i class="fa-solid fa-house"></i>الرئيسية
      </button>
      <button class="header-btn" id="logoutBtn">
        <i class="fa-solid fa-right-from-bracket"></i>تسجيل خروج
      </button>
    </div>
  </header>

  <!-- الغلاف -->
  <div class="cover" id="cover"></div>

  <!-- الصندوق الرئيسي -->
  <div class="profile-box">
    <img src="https://i.ibb.co/YRShYmn/avatar.png" alt="avatar" class="profile-img" id="profileImg">
    <h2 class="username" id="username">
      <span class="name-text" id="nameText">Oraa</span>
      <i class="fa-solid fa-crown verified" id="verifyIcon" title="حساب مميز"></i>
    </h2>
    <p class="about" id="about">عاشق الأنمي ✨ | مستكشف العوالم الخيالية 🚀 | محب للتحديات 🎯</p>

    <div class="stats">
      <div class="stat"><strong id="animeCount">0</strong><span>أنمي</span></div>
      <div class="stat"><strong id="watchTime">0</strong><span>ساعة مشاهدة</span></div>
      <div class="stat"><strong id="followers">0</strong><span>متابع</span></div>
      <div class="stat"><strong id="achievements">0</strong><span>إنجاز</span></div>
    </div>

    <div class="btns">
      <button class="btn" id="editName"><i class="fa-solid fa-user-pen"></i>تعديل الاسم</button>
      <button class="btn" id="editAbout"><i class="fa-solid fa-comment-dots"></i>تعديل النبذة</button>
      <button class="btn" id="changeImg"><i class="fa-solid fa-image"></i>تغيير الصورة</button>
      <button class="btn" id="changeCover"><i class="fa-solid fa-panorama"></i>تغيير الغلاف</button>
      <button class="btn" id="verifyBtn"><i class="fa-solid fa-shield-halved"></i>التفعيل المميز</button>
    </div>
  </div>

  <!-- الأنمي المفضلة -->
  <section class="section">
    <h3 class="section-title"><i class="fa-solid fa-heart"></i>أنمياتي المفضلة</h3>
    <div class="anime-list" id="favoriteAnimeList">
      <!-- سيتم تعبئتها ديناميكياً -->
    </div>
  </section>

  <!-- الإنجازات -->
  <section class="section">
    <h3 class="section-title"><i class="fa-solid fa-trophy"></i>إنجازاتي</h3>
    <div class="badges">
      <div class="badge"><i class="fa-solid fa-fire-flame-curved"></i><p>محترف المشاهدة</p></div>
      <div class="badge"><i class="fa-solid fa-star-sharp"></i><p>الناقد المميز</p></div>
      <div class="badge"><i class="fa-solid fa-gem"></i><p>جامع المفضلة</p></div>
      <div class="badge"><i class="fa-solid fa-wand-magic-sparkles"></i><p>ساحر التصميم</p></div>
      <div class="badge"><i class="fa-solid fa-clock"></i><p>بطل الساعات</p></div>
      <div class="badge"><i class="fa-solid fa-users"></i><p>قائد المجتمع</p></div>
    </div>
  </section>

  <footer>© 2025 OraaSlayer • صنع بكل حب 💜</footer>

  <button class="btn-home" onclick="location.href='index.html'">
    <i class="fa-solid fa-house"></i> الرئيسية
  </button>
</div>

<!-- الإشعار -->
<div class="notification" id="notification">
  <i class="fa-solid fa-circle-check"></i>
  <span id="notificationText">تم تنفيذ العملية بنجاح!</span>
</div>

<!-- النافذة المنبثقة -->
<div class="modal-overlay" id="modalOverlay">
  <div class="modal-box">
    <h3 class="modal-title" id="modalTitle"><i class="fa-solid fa-pen"></i>تعديل البيانات</h3>
    <input type="text" class="modal-input" id="modalInput" placeholder="أدخل القيمة الجديدة...">
    <div class="modal-btns">
      <button class="modal-btn cancel" id="modalCancel">إلغاء</button>
      <button class="modal-btn confirm" id="modalConfirm">تأكيد</button>
    </div>
  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
  import { 
    getAuth, 
    onAuthStateChanged, 
    signOut,
    updateProfile
  } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
  import { 
    getFirestore, 
    doc, 
    getDoc, 
    setDoc,
    updateDoc,
    serverTimestamp 
  } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
  import { 
    getStorage, 
    ref, 
    uploadBytes, 
    getDownloadURL 
  } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";

  // تكوين Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBDMFcCvthKNkHUrEbgYY1Uc80KTPpS01M",
    authDomain: "oraa-slayer-anime.firebaseapp.com",
    projectId: "oraa-slayer-anime",
    storageBucket: "oraa-slayer-anime.firebasestorage.app",
    messagingSenderId: "426607460785",
    appId: "1:426607460785:web:c8d9844253c9111ad3bd90",
    measurementId: "G-VNHP64HXD5"
  };

  // تهيئة Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const storage = getStorage(app);

  // عناصر DOM
  const loadingScreen = document.getElementById('loadingScreen');
  const loginRequired = document.getElementById('loginRequired');
  const mainContent = document.getElementById('mainContent');
  const username = document.getElementById('username');
  const nameText = document.getElementById('nameText');
  const about = document.getElementById('about');
  const profileImg = document.getElementById('profileImg');
  const coverImg = document.getElementById('cover');
  const verifyIcon = document.getElementById('verifyIcon');
  const favoriteAnimeList = document.getElementById('favoriteAnimeList');
  const notification = document.getElementById('notification');
  const notificationText = document.getElementById('notificationText');
  const logoutBtn = document.getElementById('logoutBtn');

  // عناصر النافذة المنبثقة
  const modalOverlay = document.getElementById('modalOverlay');
  const modalTitle = document.getElementById('modalTitle');
  const modalInput = document.getElementById('modalInput');
  const modalConfirm = document.getElementById('modalConfirm');
  const modalCancel = document.getElementById('modalCancel');

  let modalCallback = null;
  let currentUser = null;

  // بيانات الأنمي المفضلة
  const favoriteAnimeData = [
    { 
      title: "هجوم العمالقة", 
      img: "https://cdn.myanimelist.net/images/anime/10/47347.jpg",
      backupImg: "https://placehold.co/120x170/1a1a3a/8B7BFF?text=AOT"
    },
    { 
      title: "قاتل الشياطين", 
      img: "https://cdn.myanimelist.net/images/anime/1286/99889.jpg",
      backupImg: "https://placehold.co/120x170/1a1a3a/FF7BA9?text=KNY"
    },
    { 
      title: "ون بيس", 
      img: "https://cdn.myanimelist.net/images/anime/6/73245.jpg",
      backupImg: "https://placehold.co/120x170/1a1a3a/5FD8FF?text=OP"
    },
    { 
      title: "مذكرة الموت", 
      img: "https://cdn.myanimelist.net/images/anime/9/9453.jpg",
      backupImg: "https://placehold.co/120x170/1a1a3a/8B7BFF?text=DN"
    }
  ];

  // إظهار الإشعار
  function showNotification(message, type = 'success') {
    notificationText.textContent = message;
    notification.className = 'notification';
    notification.classList.add(type, 'show');
    
    setTimeout(() => {
      notification.classList.remove('show');
    }, 4000);
  }

  // دوال النافذة المنبثقة
  function showModal(title, defaultValue, callback, inputType = 'text') {
    modalTitle.innerHTML = `<i class="fa-solid fa-pen"></i>${title}`;
    modalInput.value = defaultValue;
    modalInput.type = inputType;
    modalCallback = callback;
    modalOverlay.classList.add('show');
    modalInput.focus();
  }

  function hideModal() {
    modalOverlay.classList.remove('show');
    modalCallback = null;
    modalInput.type = 'text';
  }

  modalConfirm.onclick = () => {
    if (modalCallback && modalInput.value.trim() !== '') {
      modalCallback(modalInput.value);
    }
    hideModal();
  };

  modalCancel.onclick = hideModal;

  modalOverlay.onclick = (e) => {
    if (e.target === modalOverlay) {
      hideModal();
    }
  };

  // تحميل بيانات المستخدم من Firebase
  async function loadUserData(user) {
    try {
      const userDoc = await getDoc(doc(db, "users", user.uid));
      
      if (userDoc.exists()) {
        const userData = userDoc.data();
        
        // تحديث واجهة المستخدم
        nameText.textContent = user.displayName || userData.username || 'مستخدم';
        about.textContent = userData.about || 'عاشق الأنمي ✨ | مستكشف العوالم الخيالية 🚀 | محب للتحديات 🎯';
        
        // تحديث الصور
        if (userData.profileImage) {
          profileImg.src = userData.profileImage;
        }
        if (userData.coverImage) {
          coverImg.style.backgroundImage = `url(${userData.coverImage})`;
        }
        
        // تحديث الإحصائيات
        document.getElementById('animeCount').textContent = userData.animeCount || '0';
        document.getElementById('watchTime').textContent = userData.watchTime || '0';
        document.getElementById('followers').textContent = userData.followers || '0';
        document.getElementById('achievements').textContent = userData.achievements || '0';
        
        // التحقق من الحساب المميز
        if (userData.verified) {
          verifyIcon.style.display = "inline";
        }
      } else {
        // إنشاء مستند جديد للمستخدم إذا لم يكن موجوداً
        await setDoc(doc(db, "users", user.uid), {
          username: user.displayName || 'مستخدم',
          email: user.email,
          about: 'عاشق الأنمي ✨ | مستكشف العوالم الخيالية 🚀 | محب للتحديات 🎯',
          profileImage: 'https://i.ibb.co/YRShYmn/avatar.png',
          coverImage: 'https://i.ibb.co/JrFz4b2/anime-banner.jpg',
          animeCount: 0,
          watchTime: 0,
          followers: 0,
          achievements: 0,
          verified: false,
          createdAt: serverTimestamp(),
          lastLogin: serverTimestamp()
        });
      }
      
      loadFavoriteAnime();
      
    } catch (error) {
      console.error("Error loading user data:", error);
      showNotification('حدث خطأ في تحميل البيانات', 'error');
    }
  }

  // تحميل الأنمي المفضلة
  function loadFavoriteAnime() {
    favoriteAnimeList.innerHTML = '';
    
    favoriteAnimeData.forEach(anime => {
      const animeCard = document.createElement('div');
      animeCard.className = 'anime-card';
      
      animeCard.innerHTML = `
        <img src="${anime.img}" alt="${anime.title}" 
             onerror="this.src='${anime.backupImg}'">
        <p>${anime.title}</p>
      `;
      
      animeCard.addEventListener('click', () => {
        localStorage.setItem('selectedAnime', JSON.stringify(anime));
        window.location.href = 'anime.html';
      });
      
      favoriteAnimeList.appendChild(animeCard);
    });
  }

  // رفع صورة إلى Firebase Storage
  async function uploadImage(file, path) {
    try {
      const storageRef = ref(storage, path);
      const snapshot = await uploadBytes(storageRef, file);
      const downloadURL = await getDownloadURL(snapshot.ref);
      return downloadURL;
    } catch (error) {
      console.error("Error uploading image:", error);
      throw error;
    }
  }

  // تعديل الاسم
  document.getElementById('editName').onclick = () => {
    const currentName = nameText.textContent;
    
    showModal("تعديل الاسم:", currentName, async (newName) => {
      try {
        // تحديث في Firebase Auth
        await updateProfile(currentUser, {
          displayName: newName
        });
        
        // تحديث في Firestore
        await updateDoc(doc(db, "users", currentUser.uid), {
          username: newName
        });
        
        nameText.textContent = newName;
        showNotification('تم تحديث الاسم بنجاح! 🌟');
      } catch (error) {
        console.error("Error updating name:", error);
        showNotification('حدث خطأ في تحديث الاسم', 'error');
      }
    });
  };

  // تعديل النبذة
  document.getElementById('editAbout').onclick = () => {
    const currentAbout = about.textContent;

    showModal("تعديل النبذة:", currentAbout, async (newAbout) => {
      try {
        await updateDoc(doc(db, "users", currentUser.uid), {
          about: newAbout
        });
        
        about.textContent = newAbout;
        showNotification('تم تحديث النبذة بنجاح! ✨');
      } catch (error) {
        console.error("Error updating about:", error);
        showNotification('حدث خطأ في تحديث النبذة', 'error');
      }
    });
  };

  // دالة مساعد لرفع الصور
  function handleImageUpload(file, maxMb, path, successMessage) {
    if (!file) return;
      
    if (file.size > maxMb * 1024 * 1024) {
      showNotification(`حجم الصورة يجب أن يكون أقل من ${maxMb}MB`, 'error');
      return;
    }
    
    showNotification('جاري رفع الصورة...', 'info');
    
    uploadImage(file, path)
      .then(async (downloadURL) => {
        // تحديث في Firestore
        const field = path.includes('profile') ? 'profileImage' : 'coverImage';
        await updateDoc(doc(db, "users", currentUser.uid), {
          [field]: downloadURL
        });
        
        // تحديث الواجهة
        if (field === 'profileImage') {
          profileImg.src = downloadURL;
        } else {
          coverImg.style.backgroundImage = `url(${downloadURL})`;
        }
        
        showNotification(successMessage, 'success');
      })
      .catch(error => {
        console.error("Error uploading image:", error);
        showNotification('حدث خطأ في رفع الصورة', 'error');
      });
  }

  // تغيير الصورة الشخصية
  document.getElementById('changeImg').onclick = () => {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    
    input.onchange = e => {
      const file = e.target.files[0];
      if (file) {
        handleImageUpload(
          file, 
          5, 
          `profile-images/${currentUser.uid}/${Date.now()}_${file.name}`,
          'تم تحديث الصورة الشخصية بنجاح! 📸'
        );
      }
    };
    
    input.click();
  };

  // تغيير صورة الغلاف
  document.getElementById('changeCover').onclick = () => {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = 'image/*';
    
    input.onchange = e => {
      const file = e.target.files[0];
      if (file) {
        handleImageUpload(
          file, 
          8, 
          `cover-images/${currentUser.uid}/${Date.now()}_${file.name}`,
          'تم تحديث صورة الغلاف بنجاح! 🖼️'
        );
      }
    };
    
    input.click();
  };

  // التفعيل المميز
  document.getElementById('verifyBtn').onclick = () => {
    showModal("أدخل كود التفعيل المميز:", "", async (code) => {
      if (code === "ORAA2025") {
        try {
          await updateDoc(doc(db, "users", currentUser.uid), {
            verified: true
          });
          
          verifyIcon.style.display = "inline";
          showNotification('🎉 تم تفعيل الحساب المميز بنجاح! استمتع بالمزايا الحصرية', 'success');
        } catch (error) {
          console.error("Error verifying account:", error);
          showNotification('حدث خطأ في التفعيل', 'error');
        }
      } else if (code) {
        showNotification('❌ كود التفعيل غير صحيح', 'error');
      }
    }, 'password');
  };

  // تسجيل الخروج
  logoutBtn.onclick = async () => {
    try {
      await signOut(auth);
      showNotification('تم تسجيل الخروج بنجاح', 'success');
      setTimeout(() => {
        window.location.href = 'login.html';
      }, 1500);
    } catch (error) {
      console.error("Error signing out:", error);
      showNotification('حدث خطأ في تسجيل الخروج', 'error');
    }
  };

  // مراقبة حالة المصادقة
  onAuthStateChanged(auth, async (user) => {
    if (user) {
      // المستخدم مسجل الدخول
      currentUser = user;
      await loadUserData(user);
      
      // إخفاء شاشة التحميل وإظهار المحتوى
      setTimeout(() => {
        loadingScreen.style.opacity = '0';
        setTimeout(() => {
          loadingScreen.style.display = 'none';
          mainContent.style.display = 'block';
        }, 500);
      }, 1000);
      
    } else {
      // المستخدم غير مسجل الدخول
      setTimeout(() => {
        loadingScreen.style.display = 'none';
        loginRequired.classList.add('show');
      }, 1000);
    }
  });

  // إضافة تأثيرات CSS للظهور
  const style = document.createElement('style');
  style.textContent = `
    .stat, .badge, .anime-card {
      opacity: 0;
      transform: translateY(30px);
      transition: all 0.6s ease-out;
    }
  `;
  document.head.appendChild(style);

  // تهيئة تأثيرات الظهور بعد تحميل البيانات
  setTimeout(() => {
    document.querySelectorAll('.stat, .badge, .anime-card').forEach((el, index) => {
      setTimeout(() => {
        el.style.opacity = '1';
        el.style.transform = 'translateY(0)';
      }, index * 100);
    });
  }, 1500);
</script>
</body>
</html>
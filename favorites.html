<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø§Ù„Ù…ÙØ¶Ù„Ø© - MIKAI Anime</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    /* ğŸ¨ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª */
    body {
      background: radial-gradient(circle at top, #1a1b2e, #0b0b18 80%);
      font-family: 'Tajawal', sans-serif;
      color: #fff;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* â¬†ï¸ Ø§Ù„Ù‡ÙŠØ¯Ø± */
    header {
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(10px);
      padding: 15px 25px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 0 15px rgba(255, 0, 150, 0.3);
      border-bottom: 3px solid #ff66cc; /* ğŸ†• Ø®Ø· ÙØ§ØµÙ„ Ø¬Ø°Ø§Ø¨ */
    }

    header h1 {
      color: #ff66cc;
      font-size: 1.6rem; /* Ø­Ø¬Ù… Ø£ÙƒØ¨Ø± */
      margin: 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    header a {
      color: #ff99dd;
      text-decoration: none;
      font-weight: bold;
      transition: 0.3s;
      font-size: 1.1rem;
    }
    header a:hover { color: #fff; transform: scale(1.05); }

    /* ğŸ”¸ Ø´Ø¨ÙƒØ© Ø§Ù„Ø£Ù†Ù…ÙŠØ§Øª */
    .anime-grid {
      flex-grow: 1; /* Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ø´Ø¨ÙƒØ© Ø¨Ø§Ù„Ù†Ù…Ùˆ */
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); /* Ø¹Ø±Ø¶ Ø£ÙƒØ¨Ø± Ù„Ù„Ø¨Ø·Ø§Ù‚Ø© */
      gap: 25px; /* Ù…Ø³Ø§ÙØ© Ø£ÙƒØ¨Ø± */
      padding: 30px 25px;
      justify-items: center;
    }

    .anime-card {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 15px;
      overflow: hidden;
      width: 180px;
      transition: 0.3s;
      box-shadow: 0 0 15px rgba(255, 0, 150, 0.25);
      position: relative;
    }

    .anime-card:hover {
      transform: translateY(-8px) scale(1.03);
      box-shadow: 0 0 25px rgba(255, 0, 150, 0.7); /* Ø¸Ù„ Ù†ÙŠÙˆÙ† Ø£Ù‚ÙˆÙ‰ */
    }

    .anime-card img {
      width: 100%;
      height: 250px; /* Ø·ÙˆÙ„ Ø£ÙƒØ¨Ø± Ù„Ù„Ø¨ÙˆØ³ØªØ± */
      object-fit: cover;
      border-bottom: 3px solid #ff66cc;
    }

    .anime-info {
      padding: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .anime-info h4 {
      margin: 5px 0 10px 0;
      font-size: 1.05rem;
      color: #ffb0ea;
    }

    .anime-info button {
      background: linear-gradient(90deg, #ff0095, #ff66cc);
      border: none;
      padding: 8px 15px;
      border-radius: 20px; /* Ø­ÙˆØ§Ù Ù…Ø³ØªØ¯ÙŠØ±Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ */
      color: #fff;
      cursor: pointer;
      transition: 0.3s;
      font-weight: bold;
      font-size: 0.9rem;
    }

    .anime-info button:hover {
      background: linear-gradient(90deg, #ff33aa, #ff80d6);
      transform: scale(1.05);
      box-shadow: 0 0 10px rgba(255, 0, 150, 0.5);
    }

    /* âŒ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ§Ø±ØºØ© */
    #emptyMessage {
      text-align: center;
      padding: 50px;
      font-size: 1.5rem;
      color: #ff99dd;
    }
    #emptyMessage i {
        color: #ff0095;
        font-size: 3rem;
        margin-bottom: 20px;
        display: block;
        animation: swing 6s infinite ease-in-out;
    }
    @keyframes swing {
        0%, 100% { transform: rotate(0deg); }
        50% { transform: rotate(5deg); }
    }

    /* ğŸ‘‘ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø§Ù„Ùƒ Ø§Ù„Ø°Ù‡Ø¨ÙŠ */
    .owner-mode header {
      border-bottom: 3px solid gold;
      box-shadow: 0 0 20px gold;
      background: rgba(255, 215, 0, 0.1);
    }
    .owner-mode header h1 { color: gold; }
    .owner-mode .owner-icon {
      color: gold;
      margin-right: 6px;
      animation: shine 2s infinite linear;
    }
    .owner-mode .anime-card {
        border: 2px solid gold;
        box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
    }
    .owner-mode .anime-card:hover {
        box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
    }

    @keyframes shine {
      0%,100% { filter: brightness(1); }
      50% { filter: brightness(1.7); }
    }

    /* ğŸ”™ Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© */
    .back-section {
      text-align: center;
      padding: 20px;
    }

    .back-section a {
      color: #ff99dd;
      text-decoration: none;
      font-weight: bold;
      font-size: 1rem;
      transition: 0.3s;
    }

    .back-section a:hover {
      color: #fff;
    }
  </style>
</head>
<body>

  <header>
    <h1><i class="fa-solid fa-heart"></i> Ù…ÙØ¶Ù„ØªÙŠ</h1>
    <a href="profile.html"><i class="fa-solid fa-user"></i> Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„</a>
  </header>

  <section class="anime-grid" id="favoritesGrid">
    </section>

  <div id="emptyMessage" style="display:none;">
    <i class="fa-regular fa-face-sad-tear"></i>
    <p>Ù‚Ø§Ø¦Ù…Ø© Ù…ÙØ¶Ù„ØªÙƒ ÙØ§Ø±ØºØ©! Ø¹Ø¯ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆØ£Ø¶Ù Ø¨Ø¹Ø¶ Ø§Ù„Ø£Ù†Ù…ÙŠØ§Øª.</p>
  </div>

  <div class="back-section">
    <a href="index.html"><i class="fa-solid fa-arrow-left"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
  </div>

  <script>
    // ğŸ’¡ Ø§Ù„Ø«ÙˆØ§Ø¨Øª
    const USERS_STORAGE_KEY = 'mikaiAnimeUsers';
    const LOGGED_IN_EMAIL = localStorage.getItem("loggedInUser");
    const OWNER_EMAIL = "itwix907@gmail.com";
    const grid = document.getElementById("favoritesGrid");
    const emptyMessage = document.getElementById("emptyMessage");

    // ------------------------------------------------------------------
    // 1. ğŸ› ï¸ Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø© ÙÙŠ localStorage
    // ------------------------------------------------------------------
    function updateFavoriteList(newFavorites) {
        if (!LOGGED_IN_EMAIL) return; // Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„

        const users = JSON.parse(localStorage.getItem(USERS_STORAGE_KEY)) || [];
        const userIndex = users.findIndex(u => u.email === LOGGED_IN_EMAIL);

        if (userIndex !== -1) {
            // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙØ¶Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
            users[userIndex].favorites = newFavorites;
            localStorage.setItem(USERS_STORAGE_KEY, JSON.stringify(users));
        }
    }

    // ------------------------------------------------------------------
    // 2. ğŸ–¼ï¸ Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    // ------------------------------------------------------------------
    function renderFavorites() {
        // Ø¥ÙØ±Ø§Øº Ø§Ù„Ø´Ø¨ÙƒØ© Ø£ÙˆÙ„Ø§Ù‹
        grid.innerHTML = ''; 

        // 1. Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ù…ÙØ¶Ù„Ø©
        const users = JSON.parse(localStorage.getItem(USERS_STORAGE_KEY)) || [];
        const currentUser = users.find(u => u.email === LOGGED_IN_EMAIL);
        
        // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ Ù„Ù… ØªÙƒÙ† Ù„Ø¯ÙŠÙ‡ Ù‚Ø§Ø¦Ù…Ø© Ù…ÙØ¶Ù„Ø©
        const favoritesList = currentUser ? (currentUser.favorites || []) : [];

        if (favoritesList.length === 0) {
            emptyMessage.style.display = 'block';
            return;
        }

        emptyMessage.style.display = 'none';

        favoritesList.forEach(anime => {
            const card = document.createElement("div");
            card.classList.add("anime-card");
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø³Ù… Ø§Ù„Ø£Ù†Ù…ÙŠ ÙƒÙ€ ID Ù„Ø¥Ø²Ø§Ù„ØªÙ‡ Ø¨Ø³Ù‡ÙˆÙ„Ø©
            card.setAttribute('data-title', anime.title); 

            card.innerHTML = `
                <img src="${anime.img}" alt="${anime.title}">
                <div class="anime-info">
                <h4>${anime.title}</h4>
                <button onclick="removeAnime('${anime.title.replace(/'/g, "\\'")}')"><i class="fa-solid fa-trash"></i> Ø¥Ø²Ø§Ù„Ø©</button>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    // ------------------------------------------------------------------
    // 3. ğŸ—‘ï¸ Ø¯Ø§Ù„Ø© Ø§Ù„Ø¥Ø²Ø§Ù„Ø© (Ù…ØªØ§Ø­Ø© Ø¹Ø§Ù„Ù…ÙŠØ§Ù‹)
    // ------------------------------------------------------------------
    window.removeAnime = function(titleToRemove) {
        const users = JSON.parse(localStorage.getItem(USERS_STORAGE_KEY)) || [];
        const userIndex = users.findIndex(u => u.email === LOGGED_IN_EMAIL);

        if (userIndex !== -1) {
            let currentFavorites = users[userIndex].favorites || [];
            
            // ØªØµÙÙŠØ© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø£Ù†Ù…ÙŠ Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚
            const newFavorites = currentFavorites.filter(anime => anime.title !== titleToRemove);
            
            // 1. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙÙŠ localStorage
            updateFavoriteList(newFavorites);

            // 2. ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            renderFavorites();

            alert("âœ… ØªÙ… Ø¥Ø²Ø§Ù„Ø© " + titleToRemove + " Ù…Ù† Ù…ÙØ¶Ù„ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­.");
        }
    }


    // ------------------------------------------------------------------
    // 4. ğŸ‘‘ Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ù…Ø§Ù„Ùƒ Ø§Ù„Ø°Ù‡Ø¨ÙŠ ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ
    // ------------------------------------------------------------------
    window.addEventListener("load", () => {
        // 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙØ¶Ù„Ø© ÙˆØ¹Ø±Ø¶Ù‡Ø§
        if (!LOGGED_IN_EMAIL) {
            // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ØŒ Ø§Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù…Ù†Ø§Ø³Ø¨Ø©
            grid.innerHTML = `<p style="text-align:center; font-size:1.2rem; padding: 50px;">ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙØ¶Ù„Ø©!</p>`;
            emptyMessage.style.display = 'none';
        } else {
            renderFavorites();
        }

        // 2. ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø§Ù„Ùƒ Ø§Ù„Ø°Ù‡Ø¨ÙŠ
        const isOwner = (LOGGED_IN_EMAIL === OWNER_EMAIL);

        if (isOwner) {
            // Ø¥Ø¶Ø§ÙØ© Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ØªØ§Ø¬
            const crown = document.createElement("i");
            crown.className = "fa-solid fa-crown owner-icon";
            const header = document.querySelector("header h1");
            header.prepend(crown);
            // ØªØ·Ø¨ÙŠÙ‚ ÙØ¦Ø© Ø§Ù„Ù…Ø§Ù„Ùƒ Ø§Ù„Ø°Ù‡Ø¨ÙŠ Ø¹Ù„Ù‰ Ø¬Ø³Ù… Ø§Ù„ØµÙØ­Ø©
            document.body.classList.add("owner-mode");
            
            // (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ø§Ù„Ù…Ø§Ù„Ùƒ
            document.querySelector("header h1").appendChild(document.createTextNode(" (Ø§Ù„Ù…Ø§Ù„Ùƒ)"));
        }
    });

  </script>

</body>
</html>
